<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ö–æ—Ä–∑–∏–Ω–∞</title>
    <link rel="stylesheet" href="style.css">
    <style>
        /* –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ –¥–ª—è –∫–æ—Ä–∑–∏–Ω—ã */
        .cart-container {
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
        }
        .cart-item {
            background:#fff;
            padding:15px;
            margin:15px 0;
            border-radius:8px;
            box-shadow:0 4px 10px rgba(0,0,0,0.1);
            display:flex;
            justify-content:space-between;
            align-items:center;
            flex-wrap: wrap;
        }
        .cart-item span {flex:2; text-align:left;}
        .cart-item input.qty-cart {
            width:60px;
            text-align:center;
            margin:0 10px;
        }
        .cart-item button.remove-btn {
            background:#e74c3c;
            color:#fff;
            border:none;
            padding:8px 15px;
            border-radius:6px;
            cursor:pointer;
        }
        .cart-item button.remove-btn:hover {background:#c0392b;}
        #order-btn {
            padding:14px 30px;
            font-size:1.1rem;
            background:#27ae60;
            color:#fff;
            border:none;
            border-radius:8px;
            cursor:pointer;
            margin-top:15px;
        }
        #order-btn:hover {background:#2ecc71;}
        #clear-cart {
            padding:12px 25px;
            background:#f39c12;
            color:#fff;
            border:none;
            border-radius:8px;
            cursor:pointer;
            margin-top:10px;
        }
        #clear-cart:hover {background:#e67e22;}
        .total-container {
            font-weight:bold;
            font-size:1.3rem;
            margin-top:20px;
        }
    </style>
</head>
<body>

<div class="top-controls">
    <button id="menuToggle" class="menu-toggle">‚ò∞ –ú–µ–Ω—é</button>
    <button id="theme-toggle" class="theme-toggle">üåô / ‚òÄÔ∏è</button>
</div>

<nav id="mainNav" class="nav-sidebar">
    <ul>
        <li><a href="index.html">–ì–ª–∞–≤–Ω–∞—è</a></li>
        <li><a href="bio.html">–ë–∏–æ–≥—Ä–∞—Ñ–∏—è</a></li>
        <li><a href="gallery.html">–ì–∞–ª–µ—Ä–µ—è</a></li>
        <li><a href="bag.html">–ë–∞–≥–∞–∂–Ω–∏–∫</a></li>
        <li><a href="form.html">–§–æ—Ä–º–∞</a></li>
        <li><a href="merches.html">–¢–æ–≤–∞—Ä—ã</a></li>
    </ul>
    <button class="close-btn">√ó</button>
</nav>
<div id="overlay" class="overlay"></div>

<div class="container cart-container">
    <h1>–í–∞—à–∞ –∫–æ—Ä–∑–∏–Ω–∞</h1>
    <div id="cart"></div>
    <div class="total-container">–ò—Ç–æ–≥–æ: <span id="total">0.00</span> ‚ÇΩ</div>
    <button id="order-btn">–°–¥–µ–ª–∞—Ç—å –∑–∞–∫–∞–∑</button>
    <br>
    <button id="clear-cart">–û—á–∏—Å—Ç–∏—Ç—å –∫–æ—Ä–∑–∏–Ω—É</button>
    <p><a href="merches.html">–í–µ—Ä–Ω—É—Ç—å—Å—è –∫ —Ç–æ–≤–∞—Ä–∞–º</a></p>
</div>

<script>
    /* === Cart Logic === */
    function getCart() {
        return JSON.parse(localStorage.getItem('cartItems') || '[]');
    }
    function saveCart(cart) {
        localStorage.setItem('cartItems', JSON.stringify(cart));
    }

    function renderCart() {
        const cartDiv = document.getElementById('cart');
        const cart = getCart();
        cartDiv.innerHTML = '';

        if(cart.length === 0){
            cartDiv.innerHTML = '<p>–ö–æ—Ä–∑–∏–Ω–∞ –ø—É—Å—Ç–∞</p>';
            document.getElementById('total').textContent = '0.00';
            return;
        }

        let total = 0;
        cart.forEach((item, idx) => {
            const div = document.createElement('div');
            div.className = 'cart-item';
            div.innerHTML = `
            <span>${item.name} ‚Äî ${item.price.toFixed(2)} ‚ÇΩ</span>
            <input type="number" class="qty-cart" value="${item.quantity}" min="1">
            <button class="remove-btn">–£–¥–∞–ª–∏—Ç—å</button>
        `;
            div.querySelector('.qty-cart').addEventListener('change', e => {
                let q = parseInt(e.target.value);
                if(isNaN(q) || q<1) q=1;
                cart[idx].quantity = q;
                saveCart(cart);
                renderCart();
            });
            div.querySelector('.remove-btn').addEventListener('click', () => {
                cart.splice(idx,1);
                saveCart(cart);
                renderCart();
            });
            cartDiv.appendChild(div);
            total += item.price * item.quantity;
        });

        document.getElementById('total').textContent = total.toFixed(2);
    }

    // –û—á–∏—Å—Ç–∫–∞ –∫–æ—Ä–∑–∏–Ω—ã
    document.getElementById('clear-cart').addEventListener('click', () => {
        localStorage.removeItem('cartItems');
        renderCart();
    });

    // –°–¥–µ–ª–∞—Ç—å –∑–∞–∫–∞–∑ (–æ—Ç–ø—Ä–∞–≤–∫–∞ JSON –Ω–∞ —Å–µ—Ä–≤–µ—Ä)
    document.getElementById('order-btn').addEventListener('click', async () => {
        const cart = getCart();
        if(cart.length === 0){
            alert("–ö–æ—Ä–∑–∏–Ω–∞ –ø—É—Å—Ç–∞!");
            return;
        }

        try {
            const res = await fetch('/order', {
                method: 'POST',
                headers: {'Content-Type':'application/json'},
                body: JSON.stringify({items: cart})
            });
            const text = await res.text();
            alert(text);

            // –û—á–∏—Å—Ç–∫–∞ –∫–æ—Ä–∑–∏–Ω—ã
            localStorage.removeItem('cartItems');
            renderCart();
        } catch(err) {
            console.error(err);
            alert("–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ –∑–∞–∫–∞–∑–∞");
        }
    });

    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
    renderCart();

    /* === Sidebar –∏ —Ç–µ–º–∞ === */
    const menuToggle = document.getElementById('menuToggle');
    const themeToggle = document.getElementById('theme-toggle');
    const sidebar = document.getElementById('mainNav');
    const overlay = document.getElementById('overlay');
    const closeBtn = sidebar.querySelector('.close-btn');

    menuToggle.addEventListener('click', ()=> {sidebar.classList.add('active'); overlay.classList.add('active');});
    closeBtn.addEventListener('click', ()=> {sidebar.classList.remove('active'); overlay.classList.remove('active');});
    overlay.addEventListener('click', ()=> {sidebar.classList.remove('active'); overlay.classList.remove('active');});

    themeToggle.addEventListener('click', ()=>{
        document.body.classList.toggle('dark');
    });
</script>

</body>
</html>
